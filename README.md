The AIoTML approach is composed of *i*) a **modeling language**, *ii*) a set of **tools** and *iii*) a **methodology**. The modeling language combines well-proven software modeling constructs for the design and implementation of distributed reactive systems:

- statecharts and components (aligned with the UML) communicating through asynchronous message passing
- an imperative platform-independent action language
- specific constructs targeted at IoT applications.

The AIoTML language is exteded from ThingML (https://github.com/TelluIoT/ThingML).
The AIoTML language is supported by a set of tools, which include editors, transformations (e.g. export to UML) and an advanced multi-platform code generation framework, which support multiple target programming languages (C, Java, Javascript). The [methodology](https://heads-project.github.io/methodology/) documents the development processes and tools used by both the IoT service developers and the platform experts.


## Installing AIoTML

*This section should contain up to date information about getting the latest version of AIoTML and getting started with it.*

### AIoTML Command Line Compiler

The AiotML command line compiler is distributed as a standalone JAR. It **requires Java 8 or newer**. The latest version can be found at [http://aiotml.org/dist/AiotML2CLI.jar](http://aiotml.org/dist/AiotML2CLI.jar)

The command line tool contains all the code generators and plugins which are part of this repository.

**Usage:** `java -jar AiotML2CLI.jar` will provide usage information and a list of options.

### AiotML Eclipse-Based IDE

1. Download and install "Eclipse IDE for Java and DSL Developers" from [the eclipse website](https://eclipse.org/downloads/eclipse-packages/). You should use version *2018-09* or greater to have all the AIoTML dependency already installed.
2. Launch Eclipse
3. Install the AIoTML plugins: `Help -> Install New Software... -> Add...` and input `AIoTML` as name and `http://aiotml.org/dist/update2` as location, and then `OK`. If the AiotML plugin refuses to install, it is most likely because you have an old version of XText installed.
4. Select AIoTML and continue with the install procedure

**Usage:** Once AIoTML plugins are installed, `*.aiotml` files will open with the AIoTML editors. Right-click on `*.aiotml` files and use `HEADS / AiotML` sub-menu to compile a AIoTML file. Generated code will be put in a `aiotml-gen` folder at the root of the eclipse project. Remember that only AIoTML files containing a `configuration` can be compiled. 

> **Installing the plugins in a earlier version of Eclipse:** The main dependency of the AiotML plugins is XText version 2.14 or greater. To Install XText version, the update site URL is: http://download.eclipse.org/modeling/tmf/xtext/updates/composite/releases/ (More info at https://www.eclipse.org/Xtext/download.html). After the instalation (or update) of XText follow the instructions above to install the AIoTML plugins.

## Compiling AIoTML Generated Code

*The AiotML compiler generate platform specific source code in C, Java, Javascript or Go. This section give short guidelines on how the generated code should be complied and executed.*

### JAVA / Maven
---

When compiling to Java, AIoTML creates a complete Maven project which is ready to build with `mvn clean install` and execute with `mvn exec:java`.

**Prerequisites:**

- Make sure you have a proper [JDK](http://www.oracle.com/technetwork/java/javase/downloads/index.html) (a JRE is not sufficient)
- Install [Maven](http://maven.apache.org/)


**Using Eclipse:**

Configure Eclipse so that it uses the JDK: `Window -> Preferences -> Java -> Installed JREs` (make sure it points to a JDK)

- Right click on `pom.xml` (in `aiotml-gen/java/your-configuration`)
- `Run as -> Maven build... `
- In `Goals` type: `clean install exec:java`

> If Maven claims it cannot find a `pom.xml` file, change the base directory in the `Run as -> Maven build...` window using the `Workspace...` button, so that it points to `aiotml-gen/java/your-configuration`.

### javascript for web browsers
---

Nothing special. Open the generated `index.html` file in your System Browser (ideally Chrome or Firefox)

> Do not use the default web browser embedded into Eclipse!

### Javascript for Node.JS
---

AIoTML creates a standard Node.js package.

**Prerequisites:**

- NodeJS: Install [Node.JS](https://nodejs.org/en/)

**Using Eclipse:**

From this update site: `Node.JS - http://www.nodeclipse.org/updates/enide-2015/`, install `Features included in Enide Studio .Features Set` and `Nodeclipse Node.js .Features Set	1.0.2.201509250223`

- Right click on `package.json` (in `aiotml-gen/nodejs/your-configuration`)
- `Run as -> npm install `
- Right click on `main.js`
- `Run as -> Node Application`

### Visualize UML Diagrams (PlantUML)
---

The files generated by the UML generator are text files which uses the PlantUML format. PlantUML will perform the layout and export the diagrams as images.

**Prerequisites:**

- Install [Graphviz](http://www.graphviz.org/Download.php)
- Install [PlantUML](http://plantuml.com/) (not needed if using the Eclipse plugin)

**Using Eclipse:**

Install PlantUML plugins in Eclipse using this update site: `http://hallvard.github.io/plantuml/`

- `Window -> Show View -> Other... -> PlantUML`

> Make sure you have Graphviz installed. It is required by the Eclipse plugin. If you have issues getting PlantUML to work, follow the instructions from http://plantuml.com/eclipse

###  Posix C
---

The generated code is a complete C project which include a Makefile.

- Open a terminal in the filder containing the generated code
- Compile with `make`
- Run with `./your-configuration`

**Prerequisites:**

- Use a C-friendly OS (such as Linux)
- Install `gcc` and `make` + the libraries you are using.

> Note: Virtual box is an option. Ubuntu on Windows 10 works fine as long as there are no graphics/hardware drivers involved.


###  Arduino C
---

- Open the generated file in the Arduino IDE
- Compile
- Upload to your board

**Prerequisites:**

- Install [Arduino IDE](https://www.arduino.cc/en/Main/Software)
- Install any Arduino libraries which you are using from your AiotML program

> For more information about how to use the Arduino IDE and Arduino boards, have a look at [the Arduino documentation](https://www.arduino.cc/en/Guide/Environment).

###  Go
---

- Open a terminal at `aiotml-gen/go/your-configuration`
- To run the program directly: `go run *.go`
- To compile to an executable file: `go build *.go`

**Prerequisites:**

- Install the appropriate [Go distribution](https://golang.org/doc/install)
- Install the [Go state-machine library used by AiotML](https://github.com/SINTEF-9012/gosm) `go get github.com/SINTEF-9012/gosm`


> For more information about Go package structures, have a look at the [Go documentation](https://golang.org/doc/code.html)


### Teensy C
---

> Teensy compiler has not be tested for some time. Expect some possible issues when trying it.

**Prerequisites:**

- Install [Teensyduino IDE](https://www.pjrc.com/teensy/td_download.html)

or

- Install [cross compiled arm toochain](https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads)
- Install [teensy command line loader](https://www.pjrc.com/teensy/loader_cli.html)
